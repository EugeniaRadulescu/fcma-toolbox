<!DOCTYPE HTML>
<!--
/*
 * Full Correlation Matrix Analysis (FCMA) demo
 *   Ben Singer <bdsinger@princeton.edu>
 * 
 * based on jQuery Uploader by Sebastian Tschan
 * Copyright 2010, https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
-->
<html lang="en">
<head>
<!-- Force latest IE rendering engine or ChromeFrame if installed -->
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><![endif]-->
<meta charset="utf-8">
<title>Princeton FCMA Toolbox</title>
<meta name="description" content="The Princeton Full Correlation Matrix Analysis (FCMA) Toolbox is a suite of tools for correlating, analyzing, and classifying patterns of correlation in functional neuroimaging datasets.">
<meta name="viewport" content="width=device-width">
<!-- Bootstrap CSS Toolkit styles -->
<link rel="stylesheet" href="../css/bootstrap.min.css">
<!-- Generic page styles -->
<link rel="stylesheet" href="../css/style.css">
<!-- Bootstrap styles for responsive website layout, supporting different screen sizes -->
<link rel="stylesheet" href="../css/bootstrap-responsive.min.css">
<!-- Bootstrap CSS fixes for IE6 -->
<!--[if lt IE 7]><link rel="stylesheet" href="http://blueimp.github.com/cdn/css/bootstrap-ie6.min.css"><![endif]-->
<!--[if lt IE 7]><link rel="stylesheet" href="http://blueimp.github.com/cdn/css/bootstrap-ie6.min.css"><![endif]-->
<!-- Shim to make HTML5 elements usable in older Internet Explorer versions -->
<!--[if lt IE 9]><script src="js/html5.js"></script><![endif]-->
</head>
<body>
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="..">FCMA Toolbox</a>
            <div class="nav-collapse">
                <ul class="nav">
                    <li><a href="../#using">Using</a></li>
                    <li><a href="../config">FCMA File</a>
                   	<li class="active"><a href="../cluster">Cluster</a></li>
			<li><a href="../tutorial">Tutorial</a></li>
<!--                   	<li><a href="http://rondo.pni.princeton.edu/fcma/demo">Demo</a></li> -->
										<li><a href="http://github.com/princetonuniversity/fcma-toolbox">Source</a></li>
										<li><a href="../thanks">Thanks</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="page-header">
		<h2>FCMA Cluster Setup</h2>
	</div>
    <blockquote>
  <p> The audience for the following section is the system administrator who will set up the cluster for FCMA.</p>
	<br><p>The FCMA Toolbox runs under MPI. The main dependencies are an MPI implementation, a C++ compiler with OpenMP support, a tuned CBLAS implentation, and <a href="http://niftilib.sourceforge.net">nifticlib 2.0</a> open source libraries. See the README files in the top-level deps/ folder in the source distribution for more details.</p>
	<br><p>At the Princeton Neuroscience Institute we use the Intel compiler with Intel MPI and MKL libraries. This makes sense for us, since our main cluster has Xeon Phi boards installed in each node. While this configuration is tested the most, we test and supply setup files for other configurations.</p>
	<br><p>The <code>Makefile</code> in the src/ directory includes a <code>Make.user</code> file that should be edited to supply, at a minimum, the location of the CBLAS implementation's headers and libraries. As long as you have <code>mpic++</code> in your <code>PATH</code> and its libraries in your <code>LD_LIBRARY_PATH</code> when you type <code>make</code> you should have no problems compiling. A <code>Make.user.linux</code> file contains the settings necessary to compile a Linux binary using  <a href="http://openblas.net">OpenBLAS</a>, <a href="http://gcc.gnu.org">GCC</a>, and <a href="http://www.open-mpi.org">OpenMPI</a>, and <code>Make.user.osx</code> contains OS X settings.</p>
<br><p>
<code>pni_fcma</code> typed alone supplies this help text:
<pre class="prettyprint"><code>
**********************************************************
Usage 1: [OMP_NUM_THREADS=n mpirun -np n -hostfile host] ./pni_fcma -d matrix_directory -m matrix_file_type -t output_file -k taskType [options]
Usage 2: [OMP_NUM_THREADS=n mpirun -np n -hostfile host] ./pni_fcma config.fcma
required:
-d matrix directory, contains files in binary gz format, beginning with numbers of row and column
-m matrix file type, usually the extension name
-k task type, 0 for voxel selection using svm, 1 for smart distance ratio, 2 for searchlight, 3 for correlation sum, 4 for two parts correlation and test, 5 for cross validation of two parts correlation, 6 for one part activation and test, 7 for cross validation of one part activation, 8 for voxel correlation visualizarion
-t output file for task 0,1,2,3 in the voxel selection mode, input file for the same tasks in the test mode
-b block information file, if no block information file, a block information directory is required
-e block directory name, will check this if -b is not provided
optional:
-s step, the number of rows to be assigned per round, default 100
-l leave out id, the first block id that being left out, default -1, which means don't leave out anything
-h number of items that held for test, default -1, only and must get values when -l is applied
-c bool, test mode (1) or not (0), default 0
-n number of folds in the feature selection, default 0
-x the first mask file, default no mask
-y the second mask file, default no mask
-v the block id that you want to visualize the correlation, must be specified in task 8
-r the referred file of the output file of task 8, must be a 4D file, usually is the input data file
-q bool, being quiet (1) or not (0) in test mode for task type 2 4 5 6 7, default 0
</code></pre>
</p>
<br><p>
The <a href="../config">FCMA File</a> page documents each of these input arguments and will generate an .fcma file that can be used with the pni_fcma_submit script, once MPI is working directly. Some effort will be required to adapt the particulars of the pni_fcma_submit script to your particular site, and advanced users may want to dispense with the layer of abstraction and use MPI directly. Several MPI implementations are scheduler-aware, obviating the need for a submit script.</p>
</p>
</blockquote>
</div>
</body>
</html>
